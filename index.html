<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Linkify - Generador de Links Multiagente</title>
  <link rel="stylesheet" href="style.css"> <!-- Enlace al archivo CSS -->
</head>
<body>
  <header id="main-header">
    <div class="logo-container">
      <img src="https://raw.githubusercontent.com/username/linkify/main/assets/logo.png" alt="Linkify" class="logo" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjgwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjx0ZXh0IHg9IjEwIiB5PSI1MCIgZm9udC1mYW1pbHk9IlNlZ29lIFVJLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjQwIiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0iIzI1ZDM2NiI+TGlua2lmeTwvdGV4dD48L3N2Zz4=';">
      <button class="plans-button" onclick="openPlansModal()">
        <span>üíé</span> Ver Planes <span class="premium-badge">Pro</span>
      </button>
    </div>
  </header>

  <!-- Modal de Planes -->
  <div class="modal-overlay" id="plans-modal">
    <div class="modal-container">
      <button class="modal-close" onclick="closePlansModal()">√ó</button>
      <div class="modal-header">
        <h2>Planes de Suscripci√≥n</h2>
        <p>Paga solo por lo que necesitas. Nuestro modelo de precios simple te permite escalar tu negocio sin complicaciones.</p>
      </div>
      <div class="plans-container">
        <div class="plan-card">
          <div class="plan-name">Plan Multiagente</div>
          <div class="plan-price">
            <span class="price-amount">3 USD</span>
            <span class="price-period">POR CADA N√öMERO / MES</span>
          </div>
          <div class="plan-features">
            <ul>
              <li>Acceso a links multiagente</li>
              <li>Soporte t√©cnico por WhatsApp</li>
              <li>Estad√≠sticas de uso</li>
              <li>Panel de administraci√≥n</li>
              <li>Distribuci√≥n equitativa de mensajes</li>
              <li>Personalizaci√≥n de links</li>
            </ul>
          </div>
          <div class="plan-actions">
            <a href="https://wa.me/+5491123456789?text=Hola%2C%20quiero%20informaci√≥n%20sobre%20los%20planes%20de%20Linkify" class="whatsapp-button" target="_blank">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"></path>
                <path fill="currentColor" d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z"></path>
              </svg>
              <span>Contratar por WhatsApp</span>
            </a>
            <a href="https://www.mercadopago.com.ar" class="mercadopago-button" target="_blank">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M19.07,7.32H4.93c-1.74,0-3.15,1.41-3.15,3.15v3.06c0,1.74,1.41,3.15,3.15,3.15h14.14c1.74,0,3.15-1.41,3.15-3.15v-3.06c0-1.74-1.41-3.15-3.15-3.15Zm-14.14,1.5h14.14c0.91,0,1.65,0.74,1.65,1.65v0.19h-17.44v-0.19c0-0.91,0.74-1.65,1.65-1.65Zm14.14,6.36H4.93c-0.91,0-1.65-0.74-1.65-1.65v-1.37h17.44v1.37c0,0.91-0.74,1.65-1.65,1.65Z"></path>
              </svg>
              <span>Pagar con Mercado Pago</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Login container with improved styling -->
    <div id="login-container" class="active card">
      <h2>Iniciar sesi√≥n</h2>
      <label for="email">Correo electr√≥nico:</label>
      <input type="email" id="email" placeholder="Ingresa tu correo electr√≥nico" required aria-label="Correo electr√≥nico">
      <label for="password">Contrase√±a:</label>
      <input type="password" id="password" placeholder="Ingresa tu contrase√±a" required aria-label="Contrase√±a">
      
      <!-- Checkbox para recordar credenciales -->
      <div class="remember-me-container">
        <label class="remember-me">
          <input type="checkbox" id="remember-me" name="remember-me">
          <span class="checkmark"></span>
          <span class="label-text">Recordarme</span>
        </label>
      </div>
      
      <button onclick="login()" aria-label="Iniciar sesi√≥n">Iniciar sesi√≥n</button>
      <p id="login-error"></p>
    </div>

    <!-- Info container moved to appear only in login screen -->
    <div class="desktop-wrapper" id="login-info">
      <div class="info-container card">
        <h2 class="info-title">¬øPara qu√© sirve Linkify?</h2>
        <p>Linkify es una herramienta creada especialmente para creadores de contenido, emprendedores y vendedores que usan WhatsApp como su canal principal de ventas y atenci√≥n al cliente.</p>
        <ul>
          <li>‚úÖ Evit√° bloqueos por enviar demasiados mensajes desde un solo n√∫mero</li>
          <li>‚úÖ Distribu√≠ el flujo de clientes entre diferentes agentes u operadores</li>
          <li>‚úÖ Atend√© m√°s r√°pido y de forma ordenada</li>
          <li>‚úÖ Escal√° tu negocio sin complicaciones</li>
        </ul>
        <p>Si vend√©s o atend√©s por WhatsApp, Linkify te ayuda a organizar tu operaci√≥n, mejorar la experiencia del cliente y aumentar tus conversiones.</p>
      </div>
    </div>

    <!-- Dashboard layout for generator -->
    <div id="generador-container" style="display: none;">
      <!-- User section with logout button -->
      <div class="user-section">
        <div class="user-info">
          <div class="user-avatar" id="user-avatar">T</div>
          <div class="user-details">
            <span class="user-name">Bienvenido</span>
            <span class="user-email" id="user-email-display">tobi@gmail.com</span>
          </div>
        </div>
        <button class="logout-button" onclick="cerrarSesion()">
          <span class="icon">‚Ü©</span>
          Cerrar sesi√≥n
        </button>
      </div>

      <h1>Generador de Links Multiagente</h1>
      
      <!-- Quick stats for dashboard feel -->
      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-label">Links Generados</div>
          <div class="stat-value" id="stats-links-count">1</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">N√∫meros Activos</div>
          <div class="stat-value" id="stats-numbers-count">2</div>
        </div>
      </div>
      
      <!-- Two-column desktop layout -->
      <div class="dashboard-layout">
        <div class="main-column">
          <form id="form" class="card">
            <h3>N√∫meros de WhatsApp</h3>
            <!-- Grid layout for number inputs -->
            <div id="numeros-container" class="numbers-grid">
              <div class="numero-container" id="numero-container-1">
                <span class="bandera-container">
                  <img src="https://flagcdn.com/w40/ar.png" alt="Argentina" class="bandera">
                </span>
                <input type="text" id="numero-1" class="numero" value="+549" placeholder="Ejemplo: 2944585356" aria-label="N√∫mero de WhatsApp">
              </div>
            </div>
            
            <div class="button-group">
              <button type="button" onclick="agregarNumero()" aria-label="Agregar otro n√∫mero"><i>+</i> Agregar otro n√∫mero</button>
              <button type="button" onclick="quitarUltimoNumero()" aria-label="Quitar √∫ltimo n√∫mero"><i>-</i> Quitar √∫ltimo n√∫mero</button>
            </div>

            <!-- Campo de mensaje autom√°tico en el generador principal -->
            <label for="mensaje">Mensaje autom√°tico:</label>
            <input type="text" id="mensaje" placeholder="Ejemplo: Hola, necesito ayuda" aria-label="Mensaje autom√°tico">

            <button type="button" onclick="generarLink()" aria-label="Generar Link">Generar Link</button>
          </form>

          <!-- Enhanced output with copy button -->
          <div class="output-container">
            <div class="output card" id="output"></div>
            <button class="copy-btn" id="copy-link-btn" onclick="copyToClipboard()" style="display: none;" aria-label="Copiar al portapapeles"></button>
          </div>
          
          <!-- Details card with consistent styling -->
          <div class="detalles-link card" id="detalles-link" style="display: none;">
            <h3>Detalles del Link Generado</h3>
            <p><strong>N√∫meros:</strong> <span id="numeros-generados"></span></p>
            <p><strong>Mensaje Autom√°tico:</strong> <span id="mensaje-generado"></span></p>
          </div>
        </div>
        
        <!-- Side column for editing -->
        <div class="side-column">
          <!-- Edit link container -->
          <div id="editar-link-container" class="card" style="display: none;">
            <h3 class="edit-title">Editar Link</h3>
            <div id="editar-numeros-container" class="numbers-grid">
              <!-- Dynamic phone number fields will be added here -->
              <div class="numero-container">
                <span class="bandera-container">
                  <img src="https://flagcdn.com/w40/ar.png" alt="Argentina" class="bandera">
                </span>
                <input type="text" id="editar-numero-1" class="numero" value="+549" placeholder="Ejemplo: +5492944585356" aria-label="Editar n√∫mero 1">
              </div>
            </div>
            <label for="editar-mensaje" class="message-label">Mensaje Autom√°tico:</label>
            <textarea id="editar-mensaje" class="message-input" rows="3" placeholder="Escribe tu mensaje aqu√≠"></textarea>
            <div class="buttons-container">
              <button onclick="actualizarLink()" class="btn btn-primary" aria-label="Actualizar Link">Actualizar Link</button>
              <button onclick="resetEditarLink()" class="btn btn-secondary" aria-label="Cancelar Edici√≥n">Cancelar</button>
            </div>
          </div>
          
          <!-- Shortened link stats could go here -->
          <div id="link-stats-container" class="card" style="display: none;">
            <h3>Estad√≠sticas de Links</h3>
            <div id="link-stats-content">
              <p>Las estad√≠sticas de tu link se mostrar√°n aqu√≠.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Acortar link container -->
    <div id="acortar-link-container" class="card" style="display: none;">
      <h3>Acortar Link</h3>
      <form id="acortar-link-form">
        <label for="link-original">Ingresa un link para acortar:</label>
        <input type="text" id="link-original" placeholder="Ejemplo: https://www.ejemplo.com" aria-label="Link para acortar" />
        <button type="button" onclick="acortarLinkManual()" aria-label="Acortar Link">Acortar Link</button>
      </form>
      <div id="acortar-link-output" class="output"></div>
    </div>

    <!-- Remove this info container that appears after login -->
    <!-- Keep only the info container inside the login-info div -->
  </div>

  <!-- Footer with updated copyright year -->
  <footer>
    <div class="footer-content">
      <div class="copyright">&copy; 2024 Linkify</div>
      <div class="footer-links">
        <a href="#">T√©rminos de Uso</a>
        <a href="#">Pol√≠tica de Privacidad</a>
        <a href="#">Soporte</a>
      </div>
    </div>
  </footer>

  <!-- Notification element with improved styling -->
  <div class="notification" id="notification"></div>

  <script>
  let contadorNumeros = 1;
  let limiteNumeros = 5; // Default value, will be updated on login

  // Function to add a new phone number field
  function agregarNumero() {
    if (contadorNumeros >= limiteNumeros) {
      showNotification(`Solo puedes agregar hasta ${limiteNumeros} n√∫meros.`, 'error');
      return;
    }

    contadorNumeros++;
    const container = document.getElementById('numeros-container');
    const nuevoCampo = document.createElement('div');
    nuevoCampo.classList.add('numero-container');
    nuevoCampo.id = `numero-container-${contadorNumeros}`;
    nuevoCampo.innerHTML = `
      <span class="bandera-container">
        <img src="https://flagcdn.com/w40/ar.png" alt="Argentina" class="bandera">
      </span>
      <input type="text" id="numero-${contadorNumeros}" class="numero" value="+549" placeholder="Ejemplo: 2944585356">
    `;
    container.appendChild(nuevoCampo);

    // Deshabilitar el bot√≥n si se alcanza el l√≠mite
    if (contadorNumeros >= limiteNumeros) {
      document.querySelector('button[onclick="agregarNumero()"]').disabled = true;
    }
  }

  // Function to remove the last phone number field
  function quitarUltimoNumero() {
    if (contadorNumeros > 1) {
      const container = document.getElementById('numeros-container');
      const ultimoCampo = document.getElementById(`numero-container-${contadorNumeros}`);
      if (ultimoCampo) {
        container.removeChild(ultimoCampo);
        contadorNumeros--;

        // Habilitar el bot√≥n si el contador est√° por debajo del l√≠mite
        if (contadorNumeros < limiteNumeros) {
          document.querySelector('button[onclick="agregarNumero()"]').disabled = false;
        }
      }
    } else {
      showNotification('Debe haber al menos un n√∫mero.', 'error');
    }
  }

  // Function to handle login
  async function login() {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    const rememberMe = document.getElementById('remember-me').checked;
    const loginButton = document.querySelector('#login-container button');
    const loginError = document.getElementById('login-error');
    
    loginError.style.display = 'none';
    loginError.textContent = '';

    if (!email || !password) {
      loginError.textContent = 'Por favor, ingresa tu correo y contrase√±a.';
      loginError.style.display = 'block';
      return;
    }

    // Mostrar estado de carga
    loginButton.innerHTML = '<span class="loading"></span> Iniciando sesi√≥n...';
    loginButton.disabled = true;

    try {
      const response = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
      });

      const data = await response.json();

      if (response.ok) {
        // Guardar el l√≠mite de n√∫meros
        limiteNumeros = data.limiteNumeros;
        localStorage.setItem('limiteNumeros', limiteNumeros);

        // Mostrar el generador y ocultar el login
        document.getElementById('login-container').style.display = 'none';
        document.getElementById('login-info').style.display = 'none';
        document.getElementById('generador-container').style.display = 'block';

        // Configurar informaci√≥n del usuario
        document.getElementById('user-avatar').textContent = email.charAt(0).toUpperCase();
        document.getElementById('user-email-display').textContent = email;

        // Guardar email en localStorage
        localStorage.setItem('usuarioEmail', email);

        if (rememberMe) {
          localStorage.setItem('rememberedEmail', email);
          localStorage.setItem('rememberMe', 'true');
        } else {
          localStorage.removeItem('rememberedEmail');
          localStorage.removeItem('rememberMe');
        }

        // Mostrar notificaci√≥n de √©xito
        showNotification('Sesi√≥n iniciada correctamente');
      } else {
        loginError.textContent = data.error;
        loginError.style.display = 'block';
      }
    } catch (error) {
      console.error('Error al iniciar sesi√≥n:', error);
      loginError.textContent = 'Error al iniciar sesi√≥n. Por favor, int√©ntalo de nuevo.';
      loginError.style.display = 'block';
    } finally {
      loginButton.innerHTML = 'Iniciar sesi√≥n';
      loginButton.disabled = false;
    }
  }

  // Function to handle logout
  function cerrarSesion() {
    const email = localStorage.getItem('usuarioEmail');

    // Limpiar datos del usuario en localStorage
    localStorage.removeItem('usuarioEmail');
    localStorage.removeItem(`linkGenerado_${email}`);
    localStorage.removeItem(`numerosGenerados_${email}`);
    localStorage.removeItem(`mensajeGenerado_${email}`);
    localStorage.removeItem(`linkID_${email}`);
    localStorage.removeItem('limiteNumeros');

    // Mostrar el contenedor de inicio de sesi√≥n
    document.getElementById('login-container').style.display = 'block';
    document.getElementById('login-info').style.display = 'block';
    document.getElementById('generador-container').style.display = 'none';

    // Limpiar el formulario de inicio de sesi√≥n
    document.getElementById('email').value = '';
    document.getElementById('password').value = '';

    // Mostrar notificaci√≥n
    showNotification('Sesi√≥n cerrada correctamente. Por favor, inicia sesi√≥n nuevamente.');
  }

  // Function to reset form state
  function resetFormState() {
    contadorNumeros = 1;
    
    // Reset the numbers container
    document.getElementById('numeros-container').innerHTML = `
      <div class="numero-container" id="numero-container-1">
        <span class="bandera-container">
          <img src="https://flagcdn.com/w40/ar.png" alt="Argentina" class="bandera">
        </span>
        <input type="text" id="numero-1" class="numero" value="+549" placeholder="Ejemplo: 2944585356" aria-label="N√∫mero de WhatsApp">
      </div>
    `;
    
    // Clear message input
    document.getElementById('mensaje').value = '';
    
    // Clear output and details
    document.getElementById('output').innerHTML = '';
    document.getElementById('detalles-link').style.display = 'none';
    
    // Enable add number button
    const addButton = document.querySelector('button[onclick="agregarNumero()"]');
    if (addButton) addButton.disabled = false;
  }

  // Function to show notification - improved
  function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    
    if (type === 'error') {
      notification.classList.add('error');
    } else {
      notification.classList.remove('error');
    }
    
    notification.classList.add('show');
    
    // Clear any existing timeout to prevent multiple timeouts
    if (notification.timeoutId) {
      clearTimeout(notification.timeoutId);
    }
    
    // Set new timeout
    notification.timeoutId = setTimeout(() => {
      notification.classList.remove('show');
    }, 3000);
  }

  // Function to generate a new link
  async function generarLink() {
    const numeros = Array.from(document.querySelectorAll('.numero'))
      .map(input => input.value.trim())
      .filter(num => num !== '' && num !== '+549'); // Filtra n√∫meros vac√≠os y el valor predeterminado

    const mensaje = document.getElementById('mensaje').value.trim();
    const email = localStorage.getItem('usuarioEmail');
    const generarButton = document.querySelector('button[onclick="generarLink()"]');

    if (!email) {
      showNotification('Por favor, inicia sesi√≥n antes de generar un link.', 'error');
      return;
    }

    if (numeros.length === 0) {
      showNotification('Por favor, ingresa al menos un n√∫mero v√°lido.', 'error');
      return;
    }

    // Mostrar estado de carga
    generarButton.innerHTML = '<span class="loading"></span> Generando...';
    generarButton.disabled = true;

    try {
      const response = await fetch('/api/soporte', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, numeros, mensaje }),
      });

      const data = await response.json();

      if (response.ok) {
        document.getElementById('output').innerHTML = `
          <p>Tu link generado:</p>
          <a href="${data.link}" target="_blank">${data.link}</a>
        `;
        document.getElementById('output').style.display = 'block';

        localStorage.setItem(`linkGenerado_${email}`, data.link);
        localStorage.setItem(`numerosGenerados_${email}`, JSON.stringify(numeros));
        localStorage.setItem(`mensajeGenerado_${email}`, mensaje);
        localStorage.setItem(`linkID_${email}`, data.id);

        document.getElementById('detalles-link').style.display = 'block';
        document.getElementById('numeros-generados').textContent = numeros.join(', ');
        document.getElementById('mensaje-generado').textContent = mensaje || 'Sin mensaje';

        showNotification('¬°Link generado con √©xito!');

        // Deshabilitar el bot√≥n despu√©s de generar el link
        generarButton.disabled = true;
      } else {
        showNotification(data.error, 'error');
        generarButton.disabled = false; // Rehabilitar el bot√≥n si hay un error
      }
    } catch (error) {
      console.error('Error generando link:', error);
      showNotification('Error al generar el link. Int√©ntalo de nuevo.', 'error');
      generarButton.disabled = false; // Rehabilitar el bot√≥n si hay un error
    } finally {
      generarButton.innerHTML = 'Generar Link';
    }
  }

  // Function to show the edit link form
  function mostrarEditarLink(numeros, mensaje) {
    const editarNumerosContainer = document.getElementById('editar-numeros-container');
    editarNumerosContainer.innerHTML = '';

    numeros.forEach((numero, index) => {
      const numeroItem = document.createElement('div');
      numeroItem.classList.add('numero-container');
      numeroItem.innerHTML = `
        <span class="bandera-container">
          <img src="https://flagcdn.com/w40/ar.png" alt="Argentina" class="bandera">
        </span>
        <input type="text" id="editar-numero-${index}" class="numero" value="${numero}" placeholder="Ejemplo: +5492944585356" aria-label="Editar n√∫mero ${index + 1}">
      `;
      editarNumerosContainer.appendChild(numeroItem);
    });

    document.getElementById('editar-mensaje').value = mensaje || '';
  }

  // Function to update a link
  async function actualizarLink() {
    const numeros = Array.from(document.querySelectorAll('#editar-numeros-container input'))
      .map(input => input.value.trim())
      .filter(num => num !== '' && num !== '+549'); // Filtra n√∫meros vac√≠os y el valor predeterminado

    const mensaje = document.getElementById('editar-mensaje').value.trim();
    const email = localStorage.getItem('usuarioEmail');
    const id = localStorage.getItem(`linkID_${email}`);
    const actualizarButton = document.querySelector('button[onclick="actualizarLink()"]');

    if (!email || !id) {
      showNotification('No se encontr√≥ un usuario o ID guardado. Por favor, inicia sesi√≥n y genera un link primero.', 'error');
      return;
    }

    if (numeros.length === 0) {
      showNotification('Por favor, ingresa al menos un n√∫mero v√°lido.', 'error');
      return;
    }

    // Mostrar estado de carga
    actualizarButton.innerHTML = '<span class="loading"></span> Actualizando...';
    actualizarButton.disabled = true;

    try {
      const response = await fetch('/api/soporte', {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, numeros, mensaje, id }),
      });

      const data = await response.json();

      if (response.ok) {
        localStorage.setItem(`numerosGenerados_${email}`, JSON.stringify(numeros));
        localStorage.setItem(`mensajeGenerado_${email}`, mensaje);

        document.getElementById('numeros-generados').textContent = numeros.join(', ');
        document.getElementById('mensaje-generado').textContent = mensaje || 'Sin mensaje';

        document.getElementById('output').innerHTML = `
          <p>Tu link actualizado:</p>
          <a href="${data.link}" target="_blank">${data.link}</a>
        `;
        document.getElementById('output').style.display = 'block';

        showNotification('¬°Link actualizado con √©xito!');
      } else {
        showNotification('Error al actualizar el link: ' + data.error, 'error');
      }
    } catch (error) {
      console.error('Error actualizando el link:', error);
      showNotification('Error al actualizar el link. Int√©ntalo de nuevo.', 'error');
    } finally {
      actualizarButton.innerHTML = 'Actualizar Link';
      actualizarButton.disabled = false;
    }
  }

  // Function to display existing link details
  async function mostrarDetallesLink() {
    const email = localStorage.getItem('usuarioEmail');
    
    if (!email) {
      console.log('No hay usuario logueado');
      return;
    }
    
    // Obtener datos del link desde localStorage
    const linkGuardado = localStorage.getItem(`linkGenerado_${email}`);
    const numerosGuardados = localStorage.getItem(`numerosGenerados_${email}`);
    const mensajeGuardado = localStorage.getItem(`mensajeGenerado_${email}`);
    
    if (linkGuardado && numerosGuardados) {
      // Mostrar detalles del link
      const numeros = JSON.parse(numerosGuardados);
      
      document.getElementById('detalles-link').style.display = 'block';
      document.getElementById('output').innerHTML = `
        <p>Tu link generado:</p>
        <a href="${linkGuardado}" target="_blank">${linkGuardado}</a>
      `;
      document.getElementById('output').style.display = 'block';
      document.getElementById('numeros-generados').textContent = numeros.join(', ');
      document.getElementById('mensaje-generado').textContent = mensajeGuardado || 'Sin mensaje';
      
      // Deshabilitar el bot√≥n "Generar Link"
      document.querySelector('button[onclick="generarLink()"]').disabled = true;
    }
  }

  // Function to manually shorten a link
  async function acortarLinkManual() {
    const linkOriginal = document.getElementById('link-original').value.trim();
    const acortarButton = document.querySelector('button[onclick="acortarLinkManual()"]');

    if (!linkOriginal) {
      showNotification('Por favor, ingresa un link para acortar.', 'error');
      return;
    }

    // Show loading state
    acortarButton.innerHTML = '<span class="loading"></span> Acortando...';
    acortarButton.disabled = true;

    try {
      // For demonstration purposes, we'll simulate a successful API response
      setTimeout(() => {
        const shortLink = `https://linkify.to/${Math.random().toString(36).substring(2, 8)}`;
        
        // Update UI with shortened link
        document.getElementById('acortar-link-output').innerHTML = `
          <p>Link acortado con √©xito:</p>
          <a href="${shortLink}" target="_blank">${shortLink}</a>
        `;
        document.getElementById('acortar-link-output').style.display = 'block';
        
        // Show success notification
        showNotification('Link acortado correctamente');
        
        // Reset button state
        acortarButton.innerHTML = 'Acortar Link';
        acortarButton.disabled = false;
      }, 1500);
    } catch (error) {
      console.error('Error al acortar el link:', error);
      showNotification('Error al acortar el link. Int√©ntalo de nuevo.', 'error');
      acortarButton.innerHTML = 'Acortar Link';
      acortarButton.disabled = false;
    }
  }

  // Check login status on page load
  document.addEventListener('DOMContentLoaded', async () => {
  const email = localStorage.getItem('usuarioEmail');

  if (email) {
    try {
      // Recuperar datos del link asociado al usuario
      const response = await fetch(`/api/soporte?email=${email}`);
      const linkData = await response.json();

      if (response.ok) {
        // Mostrar los detalles del link
        mostrarDetallesLink(linkData);

        // Mostrar el generador y ocultar el login
        document.getElementById('login-container').style.display = 'none';
        document.getElementById('generador-container').style.display = 'block';

        // Configurar informaci√≥n del usuario
        document.getElementById('user-avatar').textContent = email.charAt(0).toUpperCase();
        document.getElementById('user-email-display').textContent = email;
      } else {
        console.log('No se encontr√≥ un link asociado a este usuario.');
        cerrarSesion(); // Forzar cierre de sesi√≥n si no hay datos
      }
    } catch (error) {
      console.error('Error al recuperar los detalles del link:', error);
      cerrarSesion(); // Forzar cierre de sesi√≥n si ocurre un error
    }
  } else {
    // Forzar cierre de sesi√≥n si no hay usuario logueado
    cerrarSesion();
  }
});
  </script>
  
  <!--Start of Tawk.to Script-->
  <script type="text/javascript">
  var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
  (function(){
  var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
  s1.async=true;
  s1.src='https://embed.tawk.to/67dd9990b0e46e1906b50d72/1imsrg1n9';
  s1.charset='UTF-8';
  s1.setAttribute('crossorigin','*');
  s0.parentNode.insertBefore(s1,s0);
  })();
  </script>
  <!--End of Tawk.to Script-->
</body>
</html>